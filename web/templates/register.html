<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>{{sysname}} - 注册</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <link rel="stylesheet" href="/static/layui/css/layui.css" media="all">
  <link rel="stylesheet" href="/static/style/admin.css" media="all">
  <link rel="icon" href="/static/favicon.ico">
  <style>
    .register-container {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px 0;
    }
    .register-box {
      background: white;
      border-radius: 10px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      padding: 40px;
      width: 500px;
      max-width: 90%;
    }
    .register-header {
      text-align: center;
      margin-bottom: 30px;
    }
    .register-header h2 {
      color: #333;
      margin-bottom: 10px;
    }
    .register-header p {
      color: #666;
      font-size: 14px;
    }
    .volunteer-icon {
      font-size: 48px;
      color: #667eea;
      margin-bottom: 20px;
    }
  </style>
</head>

<body>
  <div class="register-container">
    <div class="register-box">
      <div class="register-header">
        <div class="volunteer-icon">
          <i class="layui-icon layui-icon-add-1"></i>
        </div>
        <h2>{{sysname}}</h2>
        <p>志愿者注册 - 加入我们的志愿服务团队</p>
      </div>

      <form class="layui-form" id="registerForm">
        <div class="layui-form-item">
          <label class="layui-form-label">用户名</label>
          <div class="layui-input-block">
            <input type="text" name="username" required lay-verify="required" placeholder="请输入用户名" autocomplete="off" class="layui-input">
          </div>
        </div>

        <div class="layui-form-item">
          <label class="layui-form-label">密码</label>
          <div class="layui-input-block">
            <input type="password" name="password" required lay-verify="required" placeholder="请输入密码" autocomplete="off" class="layui-input">
          </div>
        </div>

        <div class="layui-form-item">
          <label class="layui-form-label">确认密码</label>
          <div class="layui-input-block">
            <input type="password" name="confirmPassword" required lay-verify="required" placeholder="请再次输入密码" autocomplete="off" class="layui-input">
          </div>
        </div>

        <!-- 修改点：将 name="nick_name" 改为 name="nickname" -->
        <div class="layui-form-item">
          <label class="layui-form-label">昵称</label>
          <div class="layui-input-block">
            <input type="text" name="nickname" required lay-verify="required" placeholder="请输入昵称" autocomplete="off" class="layui-input">
          </div>
        </div>

        <div class="layui-form-item">
          <label class="layui-form-label">邮箱</label>
          <div class="layui-input-block">
            <input type="email" name="email" required lay-verify="required|email" placeholder="请输入邮箱地址" autocomplete="off" class="layui-input">
          </div>
        </div>

        <div class="layui-form-item">
          <label class="layui-form-label">手机号</label>
          <div class="layui-input-block">
            <input type="text" name="phone" required lay-verify="required|phone" placeholder="请输入手机号码" autocomplete="off" class="layui-input">
          </div>
        </div>

        <div class="layui-form-item">
          <label class="layui-form-label">性别</label>
          <div class="layui-input-block">
            <input type="radio" name="gender" value="1" title="男" checked>
            <input type="radio" name="gender" value="2" title="女">
          </div>
        </div>

        <div class="layui-form-item">
          <label class="layui-form-label">出生日期</label>
          <div class="layui-input-block">
            <input type="text" name="birthday" id="birthday" placeholder="请选择出生日期" autocomplete="off" class="layui-input">
          </div>
        </div>

        <div class="layui-form-item">
          <label class="layui-form-label">地址</label>
          <div class="layui-input-block">
            <input type="text" name="address" placeholder="请输入地址（可选）" autocomplete="off" class="layui-input">
          </div>
        </div>

        <div class="layui-form-item">
          <div class="layui-input-block">
            <button class="layui-btn layui-btn-fluid" lay-submit lay-filter="register">立即注册</button>
          </div>
        </div>

        <div class="layui-form-item" style="text-align: center;">
          <a href="/login" class="layui-link">已有账号？立即登录</a>
        </div>
      </form>
    </div>
  </div>

  <script src="/static/layui/layui.js"></script>
  <script>
    layui.use(['form', 'layer', 'laydate'], function () {
      var form = layui.form;
      var layer = layui.layer;
      var laydate = layui.laydate;

      // 初始化日期选择器
      laydate.render({
        elem: '#birthday',
        type: 'date'
      });

      // 监听提交
      form.on('submit(register)', function (data) {
        // 验证密码一致性
        if (data.field.password !== data.field.confirmPassword) {
          layer.msg('两次输入的密码不一致', {icon: 2});
          return false;
        }

        var loading = layer.load(2);

        // 移除确认密码字段
        delete data.field.confirmPassword;

        fetch('/register', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data.field)
        })
        .then(response => response.json())
        .then(result => {
          layer.close(loading);
          if (result.success) {
            layer.msg('注册成功！', {icon: 1});
            setTimeout(function() {
              window.location.href = '/login';
            }, 1500);
          } else {
            layer.msg(result.msg || '注册失败', {icon: 2});
          }
        })
        .catch(error => {
          layer.close(loading);
          layer.msg('网络错误，请重试', {icon: 2});
        });

        return false;
      });
    });
  </script>
</body>

</html>
