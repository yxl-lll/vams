<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>活动参与记录</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <link rel="stylesheet" href="/static/layui/css/layui.css" media="all">
  <link rel="stylesheet" href="/static/style/admin.css" media="all">
  <style>
    .page-header {
      background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
      color: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .page-header h2 {
      margin: 0;
      font-size: 24px;
    }
    .page-header p {
      margin: 10px 0 0 0;
      opacity: 0.9;
    }
    .search-panel {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .toolbar {
      margin-bottom: 15px;
    }
    .status-badge {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      color: white;
    }
    .status-registered { background-color: #6c757d; }
    .status-checked_in { background-color: #007bff; }
    .status-completed { background-color: #28a745; }
    .status-cancelled { background-color: #dc3545; }
    .stats-cards {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
    }
    .stat-card {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      flex: 1;
      text-align: center;
    }
    .stat-card .number {
      font-size: 32px;
      font-weight: bold;
      color: #17a2b8;
    }
    .stat-card .label {
      color: #666;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="layui-fluid">
    <!-- 页面头部 -->
    <div class="page-header">
      <h2><i class="layui-icon layui-icon-copyright"></i> 活动参与记录</h2>
      <p>记录志愿者活动参与情况，支持签到签退和服务时长统计</p>
    </div>

    <!-- 统计卡片 -->
    <div class="stats-cards">
      <div class="stat-card">
        <div class="number" id="totalActivities">0</div>
        <div class="label">参与活动总数</div>
      </div>
      <div class="stat-card">
        <div class="number" id="totalHours">0.0</div>
        <div class="label">累计服务时长(小时)</div>
      </div>
      <div class="stat-card">
        <div class="number" id="completedActivities">0</div>
        <div class="label">已完成活动</div>
      </div>
      <div class="stat-card">
        <div class="number" id="ongoingActivities">0</div>
        <div class="label">进行中活动</div>
      </div>
    </div>

    <div class="layui-card">
      <div class="layui-card-body">
        <!-- 搜索面板 -->
        <div class="search-panel">
          <form class="layui-form" lay-filter="searchForm">
            <div class="layui-form-item">
              <div class="layui-inline">
                <label class="layui-form-label">活动名称</label>
                <div class="layui-input-inline">
                  <input type="text" name="activity_name" placeholder="请输入活动名称" autocomplete="off" class="layui-input">
                </div>
              </div>
              <div class="layui-inline">
                <label class="layui-form-label">状态</label>
                <div class="layui-input-inline">
                  <select name="status">
                    <option value="">全部状态</option>
                    <option value="registered">已报名</option>
                    <option value="checked_in">已签到</option>
                    <option value="completed">已完成</option>
                    <option value="cancelled">已取消</option>
                  </select>
                </div>
              </div>
              <div class="layui-inline">
                <button class="layui-btn" lay-submit lay-filter="search">
                  <i class="layui-icon layui-icon-search"></i> 搜索
                </button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
              </div>
            </div>
          </form>
        </div>

        <!-- 工具栏 -->
        <div class="toolbar">
          <button class="layui-btn" id="addBtn">
            <i class="layui-icon layui-icon-add-1"></i> 报名活动
          </button>
          <button class="layui-btn layui-btn-normal" id="checkInBtn">
            <i class="layui-icon layui-icon-ok"></i> 批量签到
          </button>
          <button class="layui-btn layui-btn-warm" id="checkOutBtn">
            <i class="layui-icon layui-icon-close"></i> 批量签退
          </button>
          <button class="layui-btn layui-btn-danger" id="batchDeleteBtn">
            <i class="layui-icon layui-icon-delete"></i> 批量删除
          </button>
        </div>

        <!-- 数据表格 -->
        <table class="layui-hide" id="dataTable" lay-filter="dataTable"></table>
      </div>
    </div>
  </div>

  <!-- 表格操作列模板 -->
  <script type="text/html" id="operationTpl">
    {{# if(d.status === 'registered'){ }}
      <a class="layui-btn layui-btn-xs layui-btn-normal" lay-event="checkin">签到</a>
      <a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="cancel">取消</a>
    {{# } else if(d.status === 'checked_in'){ }}
      <a class="layui-btn layui-btn-xs layui-btn-warm" lay-event="checkout">签退</a>
    {{# } }}
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-xs layui-btn-normal" lay-event="view">查看</a>
    <a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="del">删除</a>
  </script>

  <!-- 状态列模板 -->
  <script type="text/html" id="statusTpl">
    {{# if(d.status === 'registered'){ }}
      <span class="status-badge status-registered">已报名</span>
    {{# } else if(d.status === 'checked_in'){ }}
      <span class="status-badge status-checked_in">已签到</span>
    {{# } else if(d.status === 'completed'){ }}
      <span class="status-badge status-completed">已完成</span>
    {{# } else if(d.status === 'cancelled'){ }}
      <span class="status-badge status-cancelled">已取消</span>
    {{# } }}
  </script>

  <!-- 报名活动弹窗 -->
  <div id="addModal" style="display: none; padding: 20px;">
    <form class="layui-form" lay-filter="addForm">
      <div class="layui-form-item">
        <label class="layui-form-label">活动名称</label>
        <div class="layui-input-block">
          <select name="activity_id" lay-verify="required" lay-search>
            <option value="">请选择要报名的活动</option>
          </select>
        </div>
      </div>

      <div class="layui-form-item">
        <label class="layui-form-label">参与人数</label>
        <div class="layui-input-inline">
          <input type="number" name="participant_count" required lay-verify="required" placeholder="人数" autocomplete="off" class="layui-input" min="1" value="1">
        </div>
        <div class="layui-form-mid layui-word-aux">人</div>
      </div>

      <div class="layui-form-item">
        <label class="layui-form-label">备注</label>
        <div class="layui-input-block">
          <textarea name="remark" placeholder="请输入备注信息" class="layui-textarea"></textarea>
        </div>
      </div>

      <div class="layui-form-item">
        <div class="layui-input-block">
          <button class="layui-btn" lay-submit lay-filter="addSubmit">确认报名</button>
          <button type="reset" class="layui-btn layui-btn-primary">重置</button>
        </div>
      </div>
    </form>
  </div>

  <!-- 签到弹窗 -->
  <div id="checkInModal" style="display: none; padding: 20px;">
    <form class="layui-form" lay-filter="checkInForm">
      <div class="layui-form-item">
        <label class="layui-form-label">签到时间</label>
        <div class="layui-input-block">
          <input type="text" name="check_in_time" id="check_in_time" required lay-verify="required" placeholder="请选择签到时间" autocomplete="off" class="layui-input">
        </div>
      </div>

      <div class="layui-form-item">
        <div class="layui-input-block">
          <button class="layui-btn" lay-submit lay-filter="checkInSubmit">确认签到</button>
        </div>
      </div>
    </form>
  </div>

  <!-- 签退弹窗 -->
  <div id="checkOutModal" style="display: none; padding: 20px;">
    <form class="layui-form" lay-filter="checkOutForm">
      <div class="layui-form-item">
        <label class="layui-form-label">签退时间</label>
        <div class="layui-input-block">
          <input type="text" name="check_out_time" id="check_out_time" required lay-verify="required" placeholder="请选择签退时间" autocomplete="off" class="layui-input">
        </div>
      </div>

      <div class="layui-form-item">
        <label class="layui-form-label">服务时长</label>
        <div class="layui-input-inline">
          <input type="number" name="service_hours" required lay-verify="required" placeholder="小时" autocomplete="off" class="layui-input" step="0.5" min="0.5">
        </div>
        <div class="layui-form-mid layui-word-aux">小时</div>
      </div>

      <div class="layui-form-item">
        <div class="layui-input-block">
          <button class="layui-btn" lay-submit lay-filter="checkOutSubmit">确认签退</button>
        </div>
      </div>
    </form>
  </div>

  <script src="/static/layui/layui.js"></script>
  <script>
    layui.use(['table', 'form', 'layer', 'laydate'], function () {
      var table = layui.table;
      var form = layui.form;
      var layer = layui.layer;
      var laydate = layui.laydate;
      var $ = layui.$;

      // 全局变量
      var currentEditRecordId = null;
      var currentCheckInRecords = [];
      var currentCheckOutRecords = [];
      var AUTH_TOKEN = getToken();

      if (!AUTH_TOKEN) {
        layer.msg('请先登录', {icon: 2}, function() {
          window.location.href = '/login';
        });
      }

      // 初始化日期选择器
      laydate.render({ elem: '#check_in_time', type: 'datetime', value: new Date() });
      laydate.render({ elem: '#check_out_time', type: 'datetime', value: new Date() });

      // 加载所有活动（前端过滤已通过审核的）
      function loadAvailableActivities() {
        fetch('/volunteer_plans/list', {
          headers: { 'Authorization': 'Bearer ' + AUTH_TOKEN }
        })
        .then(res => res.json())
        .then(result => {
          if (result.code === 0 && Array.isArray(result.data)) {
            var approvedActivities = result.data.filter(activity => activity.status === 'approved');
            var options = '<option value="">请选择要报名的活动</option>';
            approvedActivities.forEach(item => {
              options += `<option value="${item.id}"
                data-name="${item.activity_name || ''}"
                data-type="${item.activity_type || '其他'}"
                data-date="${item.activity_date || ''}"
                data-hours="${item.service_hours || 2.0}"
                data-image="${item.activity_image || ''}">
                ${item.activity_name || '未知活动'}
              </option>`;
            });
            $('select[name="activity_id"]').html(options);
            form.render('select');
          } else {
            layer.msg('加载活动列表失败: ' + (result.msg || '网络错误'), {icon: 2});
          }
        })
        .catch(error => {
          console.error('加载活动列表错误:', error);
          layer.msg('加载活动列表失败，请检查网络连接', {icon: 2});
        });
      }

      // 加载统计数据
      function loadStatistics() {
        if (!AUTH_TOKEN) return;
        fetch('/participation/statistics', {
          headers: {'Authorization': 'Bearer ' + AUTH_TOKEN}
        })
        .then(res => res.json())
        .then(result => {
          if (result.code === 0) {
            $('#totalActivities').text(result.data.total_activities || 0);
            $('#totalHours').text(result.data.total_hours || 0.0);
            $('#completedActivities').text(result.data.completed_activities || 0);
            $('#ongoingActivities').text(result.data.ongoing_activities || 0);
          }
        });
      }

      // 初始化表格
      var tableIns = table.render({
        elem: '#dataTable',
        url: '/participation/page',
        method: 'GET',
        headers: { 'Authorization': 'Bearer ' + AUTH_TOKEN },
        page: true,
        limit: 20,
        limits: [10, 20, 50, 100],
        height: 'full-300',
        text: { none: '暂无数据' },
        cols: [[
          {type: 'checkbox', fixed: 'left'},
          {field: 'activity_name', title: '活动名称', width: 200, fixed: 'left'},
          {field: 'activity_type', title: '活动类型', width: 120},
          {field: 'activity_date', title: '活动日期', width: 160},
          {field: 'service_hours', title: '服务时长', width: 100},
          {field: 'participant_count', title: '参与人数', width: 100},
          {field: 'check_in_time', title: '签到时间', width: 160},
          {field: 'check_out_time', title: '签退时间', width: 160},
          {field: 'status', title: '状态', width: 100, templet: '#statusTpl'},
          {field: 'user_name', title: '志愿者', width: 100},
          {field: 'created_at', title: '报名时间', width: 160},
          {title: '操作', width: 300, toolbar: '#operationTpl', fixed: 'right'}
        ]],
        response: {
          statusName: 'code',
          statusCode: 0,
          msgName: 'msg',
          countName: 'count',
          dataName: 'data'
        }
      });

      // 搜索功能
      form.on('submit(search)', function (data) {
        tableIns.reload({ where: data.field, page: {curr: 1} });
        return false;
      });

      // 报名按钮
      $('#addBtn').on('click', function () {
        layer.open({
          type: 1, title: '报名活动', area: ['500px', '400px'],
          content: $('#addModal'),
          success: loadAvailableActivities,
          end: () => $('#addModal')[0].reset()
        });
      });

      // 批量签到
      $('#checkInBtn').on('click', function () {
        var checkStatus = table.checkStatus('dataTable');
        var registeredRecords = checkStatus.data.filter(item => item.status === 'registered');
        if (registeredRecords.length === 0) {
          return layer.msg('请选择要签到的记录', {icon: 2});
        }
        currentCheckInRecords = registeredRecords;
        showCheckInModal();
      });

      // 批量签退
      $('#checkOutBtn').on('click', function () {
        var checkStatus = table.checkStatus('dataTable');
        var checkedInRecords = checkStatus.data.filter(item => item.status === 'checked_in');
        if (checkedInRecords.length === 0) {
          return layer.msg('请选择要签退的记录', {icon: 2});
        }
        currentCheckOutRecords = checkedInRecords;
        showCheckOutModal();
      });
      
      // 批量删除
      $('#batchDeleteBtn').on('click', function () {
        var checkStatus = table.checkStatus('dataTable');
        var data = checkStatus.data;
        if (data.length === 0) {
          return layer.msg('请选择要删除的数据', {icon: 2});
        }
        layer.confirm(`确定删除选中的 ${data.length} 条数据吗？`, function (index) {
          var loading = layer.load(2);
          var promises = data.map(item => 
            fetch(`/participation/delete/${item.id}`, {
              method: 'DELETE', headers: {'Authorization': 'Bearer ' + AUTH_TOKEN}
            }).then(res => res.json())
          );
          Promise.all(promises)
            .then(results => {
              layer.close(loading);
              var failedCount = results.filter(res => res.code !== 0).length;
              if (failedCount === 0) {
                layer.msg(`批量删除成功（共${data.length}条）`, {icon: 1});
              } else {
                layer.msg(`部分删除失败（${failedCount}条），请重试`, {icon: 7});
              }
              tableIns.reload();
              loadStatistics();
            })
            .catch(() => {
              layer.close(loading);
              layer.msg('批量删除失败，请重试', {icon: 2});
            });
          layer.close(index);
        });
      });

      // 表格工具事件
      table.on('tool(dataTable)', function (obj) {
        var data = obj.data;
        switch (obj.event) {
          case 'checkin':
            currentCheckInRecords = [data];
            showCheckInModal();
            break;
          case 'checkout':
            currentCheckOutRecords = [data];
            showCheckOutModal();
            break;
          case 'cancel':
            layer.confirm('确定取消报名吗？', function(index) {
              var loading = layer.load(2);
              fetch(`/participation/cancel/${data.id}`, {
                method: 'POST', headers: {'Authorization': 'Bearer ' + AUTH_TOKEN}
              })
              .then(res => res.json())
              .then(result => {
                layer.close(loading);
                if (result.code === 0) {
                  obj.del();
                  layer.msg('取消报名成功', {icon: 1});
                  loadStatistics();
                } else {
                  layer.msg(result.msg || '取消失败', {icon: 2});
                }
              });
              layer.close(index);
            });
            break;
          case 'edit':
            showEditModal(data);
            break;
          case 'view':
            showViewModal(data);
            break;
          case 'del':
            layer.confirm('确定删除此记录吗？', function(index) {
              var loading = layer.load(2);
              fetch(`/participation/delete/${data.id}`, {
                method: 'DELETE', headers: {'Authorization': 'Bearer ' + AUTH_TOKEN}
              })
              .then(res => res.json())
              .then(result => {
                layer.close(loading);
                if (result.code === 0) {
                  obj.del();
                  layer.msg('删除成功', {icon: 1});
                  loadStatistics();
                } else {
                  layer.msg(result.msg || '删除失败', {icon: 2});
                }
              });
              layer.close(index);
            });
            break;
        }
      });

      // 报名提交
      form.on('submit(addSubmit)', function (data) {
        var activityId = data.field.activity_id;
        if (!activityId) return layer.msg('请选择活动', {icon: 2});
        
        var selectedOption = $(`select[name="activity_id"] option[value="${activityId}"]`);
        var activityData = selectedOption.data();
        var submitData = {
          activity_id: activityId,
          activity_name: activityData.name || '',
          activity_image: activityData.image || null,
          activity_date: activityData.date || new Date().toISOString(),
          activity_type: activityData.type || '其他',
          service_hours: activityData.hours || 2.0,
          participant_count: parseInt(data.field.participant_count) || 1,
          remark: data.field.remark || null
        };

        var loading = layer.load(2);
        fetch('/participation/add', {
          method: 'POST',
          headers: {'Content-Type': 'application/json', 'Authorization': 'Bearer ' + AUTH_TOKEN},
          body: JSON.stringify(submitData)
        })
        .then(res => res.json())
        .then(result => {
          layer.close(loading);
          if (result.code === 0) {
            layer.closeAll();
            layer.msg('报名成功', {icon: 1});
            tableIns.reload();
            loadStatistics();
          } else {
            layer.msg(result.msg || '报名失败', {icon: 2});
          }
        })
        .catch(() => {
          layer.close(loading);
          layer.msg('网络错误，请重试', {icon: 2});
        });
        return false;
      });

      // 编辑提交
      form.on('submit(editSubmit)', function (data) {
        if (!currentEditRecordId) return layer.msg('记录ID缺失', {icon: 2});
        
        var loading = layer.load(2);
        fetch(`/participation/update/${currentEditRecordId}`, {
          method: 'PUT',
          headers: {'Content-Type': 'application/json', 'Authorization': 'Bearer ' + AUTH_TOKEN},
          body: JSON.stringify(data.field)
        })
        .then(res => res.json())
        .then(result => {
          layer.close(loading);
          if (result.code === 0) {
            layer.closeAll();
            layer.msg('修改成功', {icon: 1});
            tableIns.reload();
          } else {
            layer.msg(result.msg || '修改失败', {icon: 2});
          }
        })
        .catch(() => {
          layer.close(loading);
          layer.msg('网络错误，请重试', {icon: 2});
        });
        return false;
      });

      // 签到提交
      form.on('submit(checkInSubmit)', function (data) {
        if (currentCheckInRecords.length === 0) return layer.msg('请选择要签到的记录', {icon: 2});
        
        var loading = layer.load(2);
        var promises = currentCheckInRecords.map(item => 
          fetch(`/participation/checkin/${item.id}`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json', 'Authorization': 'Bearer ' + AUTH_TOKEN},
            body: JSON.stringify({ check_in_time: data.field.check_in_time })
          }).then(res => res.json())
        );
        Promise.all(promises)
          .then(results => {
            layer.close(loading);
            var failedCount = results.filter(res => res.code !== 0).length;
            if (failedCount === 0) {
              layer.closeAll();
              layer.msg(`批量签到成功（共${currentCheckInRecords.length}条）`, {icon: 1});
            } else {
              layer.msg(`部分签到失败（${failedCount}条），请重试`, {icon: 7});
            }
            tableIns.reload();
            loadStatistics();
          })
          .catch(() => {
            layer.close(loading);
            layer.msg('批量签到失败，请重试', {icon: 2});
          });
        return false;
      });

      // 签退提交
      form.on('submit(checkOutSubmit)', function (data) {
        if (currentCheckOutRecords.length === 0) return layer.msg('请选择要签退的记录', {icon: 2});
        
        var loading = layer.load(2);
        var promises = currentCheckOutRecords.map(item => 
          fetch(`/participation/checkout/${item.id}`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json', 'Authorization': 'Bearer ' + AUTH_TOKEN},
            body: JSON.stringify({
              check_out_time: data.field.check_out_time,
              service_hours: parseFloat(data.field.service_hours) || 0.5
            })
          }).then(res => res.json())
        );
        Promise.all(promises)
          .then(results => {
            layer.close(loading);
            var failedCount = results.filter(res => res.code !== 0).length;
            if (failedCount === 0) {
              layer.closeAll();
              layer.msg(`批量签退成功（共${currentCheckOutRecords.length}条）`, {icon: 1});
            } else {
              layer.msg(`部分签退失败（${failedCount}条），请重试`, {icon: 7});
            }
            tableIns.reload();
            loadStatistics();
          })
          .catch(() => {
            layer.close(loading);
            layer.msg('批量签退失败，请重试', {icon: 2});
          });
        return false;
      });

      // 辅助函数：显示弹窗
      function showCheckInModal() {
        layer.open({
          type: 1, title: `批量签到（共${currentCheckInRecords.length}条）`, area: ['500px', '300px'],
          content: $('#checkInModal'),
          end: () => $('#checkInModal')[0].reset()
        });
      }
      function showCheckOutModal() {
        layer.open({
          type: 1, title: `批量签退（共${currentCheckOutRecords.length}条）`, area: ['500px', '350px'],
          content: $('#checkOutModal'),
          end: () => $('#checkOutModal')[0].reset()
        });
      }
      function showViewModal(data) {
        var content = `
          <div style="padding: 20px;"><table class="layui-table" lay-skin="line">
            <tr><td width="120">活动名称：</td><td>${data.activity_name || '-'}</td></tr>
            <tr><td>活动类型：</td><td>${data.activity_type || '-'}</td></tr>
            <tr><td>活动日期：</td><td>${data.activity_date || '-'}</td></tr>
            <tr><td>服务时长：</td><td>${data.service_hours || '-'} 小时</td></tr>
            <tr><td>参与人数：</td><td>${data.participant_count || '-'} 人</td></tr>
            <tr><td>签到时间：</td><td>${data.check_in_time || '-'}</td></tr>
            <tr><td>签退时间：</td><td>${data.check_out_time || '-'}</td></tr>
            <tr><td>状态：</td><td>${getStatusText(data.status)}</td></tr>
            <tr><td>备注：</td><td>${data.remark || '-'}</td></tr>
            <tr><td>志愿者：</td><td>${data.user_name || '-'}</td></tr>
            <tr><td>报名时间：</td><td>${data.created_at || '-'}</td></tr>
          </table></div>`;
        layer.open({ type: 1, title: '参与记录详情', area: ['700px', '500px'], content: content });
      }
      function showEditModal(data) {
        currentEditRecordId = data.id;
        var content = `
          <div style="padding: 20px;">
            <form class="layui-form" lay-filter="editForm">
              <div class="layui-form-item"><label class="layui-form-label">活动名称</label><div class="layui-input-block"><input type="text" value="${data.activity_name || '-'}" readonly class="layui-input layui-disabled"></div></div>
              <div class="layui-form-item"><label class="layui-form-label">参与人数</label><div class="layui-input-inline"><input type="number" name="participant_count" value="${data.participant_count || 1}" required lay-verify="required" class="layui-input" min="1"></div></div>
              <div class="layui-form-item"><label class="layui-form-label">备注</label><div class="layui-input-block"><textarea name="remark" class="layui-textarea">${data.remark || ''}</textarea></div></div>
              <div class="layui-form-item"><div class="layui-input-block"><button class="layui-btn" lay-submit lay-filter="editSubmit">保存修改</button><button type="button" class="layui-btn layui-btn-primary" onclick="layer.closeAll()">取消</button></div></div>
            </form>
          </div>`;
        layer.open({
          type: 1, title: '编辑参与记录', area: ['500px', '400px'],
          content: content,
          success: () => form.render()
        });
      }

      // 辅助函数：获取状态文本
      function getStatusText(status) {
        var statusMap = {
          'registered': '已报名', 'checked_in': '已签到',
          'completed': '已完成', 'cancelled': '已取消'
        };
        return statusMap[status] || status;
      }
      
      // 辅助函数：从Cookie获取Token
      function getToken() {
        return document.cookie.split(';').find(c => c.trim().startsWith('token='))?.split('=')[1];
      }

      // 页面加载时初始化
      $(function() {
        if (AUTH_TOKEN) {
          loadStatistics();
        }
      });
    });
  </script>
</body>
</html>
